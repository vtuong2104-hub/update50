<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Th∆∞ vi·ªán c√∫c cu ‚ö°‚ö° (Full + Background)</title>

<link rel="preconnect" href="https://i.supaimg.com"> 

<style>
body {
    margin:0;
    font-family:'Segoe UI',sans-serif;
    color:#333;
    overflow-x:hidden;
    background-size:cover;
    background-position:center;
    background-attachment:fixed;
    position:relative;
}
body.lock-scroll {overflow:hidden;}

#mainBackgroundOverlay {
    position:fixed;
    inset:0;
    z-index:-1; 
    backdrop-filter: blur(8px); 
    background:rgba(255,255,255,0.5); 
    opacity: 1; 
    transition: opacity 0.5s ease;
}

header {
    background-color:#fff;
    padding:10px 20px;
    box-shadow:0 1px 3px rgba(0,0,0,0.1);
    position:sticky;
    top:0;
    z-index:1000;
    display:flex;
    justify-content:space-between;
    align-items:center;
}
header h1 {color:#e60023;font-size:24px;margin:0;font-weight:800;letter-spacing:-1px;}
.datetime {font-size:14px;font-weight:600;color:#666;text-align:right;}
.datetime span {display:block;line-height:1.2;}

/* --- ƒê√É CH·ªàNH S·ª¨A CHO N√öT NH·ªé L·∫†I --- */
#socialLinks {
    position: fixed;
    bottom: 20px; 
    left: 20px; 
    z-index: 3001; 
    width: auto; 
    display: flex;
    flex-direction: column;
    gap: 8px; /* Gi·∫£m kho·∫£ng c√°ch gi·ªØa c√°c n√∫t */
    align-items: flex-start; 
    padding: 0;
}
#socialLinks a {
    display: block;
    width: 100px; /* Gi·∫£m chi·ªÅu r·ªông c·ªßa n√∫t (t·ª´ 120px) */
    text-align: center;
    padding: 8px 0; /* Gi·∫£m padding (chi·ªÅu cao) c·ªßa n√∫t (t·ª´ 10px 0) */
    border-radius: 8px; /* Gi·∫£m nh·∫π bo g√≥c (t·ª´ 10px) */
    text-decoration: none; 
    font-size: 14px; /* Gi·∫£m nh·∫π k√≠ch th∆∞·ªõc ch·ªØ (t·ª´ 15px) */
    font-weight: 700;
    color: #fff;
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3); /* Gi·∫£m nh·∫π ƒë·ªï b√≥ng */
    transition: transform 0.2s, opacity 0.2s;
}
/* ------------------------------------- */

#tiktokLink {background: #000; border: 3px solid #fff; color: #fff;}
#facebookLink {background: #1877F2; border: 3px solid #fff; color: #fff;}
#socialLinks a:active {transform: scale(0.98);}

#dailyBanner{
    display:flex;
    justify-content:flex-start;
    gap:15px;
    padding:18px;
    position:fixed;
    top:45px;
    left:50%;
    transform:translateX(-50%);
    max-width:500px;
    width:89%;
    z-index:999;
    background:rgba(255,255,255,0.7); 
    backdrop-filter:blur(10px); 
    border-radius:0 0 16px 16px;
    border:1px solid rgba(255,255,255,0.8);
    box-shadow:0 4px 20px rgba(0,0,0,0.2),0 0 15px rgba(255,255,255,0.4) inset;
    overflow-x:auto;
    white-space:nowrap;
    transition:opacity 0.5s;
}
#dailyBanner::-webkit-scrollbar {display:none;}
#dailyBanner img{width:160px;height:220px;flex-shrink:0;object-fit:cover;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.3);border:none;transition:transform 0.3s,box-shadow 0.3s;cursor:pointer;}
#dailyBanner img:hover{transform:scale(1.05);box-shadow:0 8px 20px rgba(0,0,0,0.5);}
.banner-label {position:fixed;left:50%;transform:translateX(-50%);padding:6px 12px;background:#e60023;border-radius:8px;color:#fff;font-size:13px;font-weight:600;box-shadow:0 2px 8px rgba(0,0,0,0.3);z-index:1100;white-space:nowrap;transition:opacity 0.5s;}

main {padding-top:295px;transition:padding-top 0.5s;}
.gallery-container {max-width:1200px;margin:0 auto;padding:10px;column-count:2;column-gap:15px;opacity:0;transition:opacity 0.5s;}
@media (min-width:768px){.gallery-container{column-count:3;}}
.image-frame {
    break-inside:avoid-column;
    width:100%;
    margin-bottom:15px;
    border-radius:16px;
    overflow:hidden;
    background-color:#fff;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
    cursor:pointer;
    position:relative;
    transition:box-shadow .3s,transform .3s;
}
.image-frame:hover {box-shadow:0 8px 16px rgba(0,0,0,0.3);transform:translateY(-5px);}

.image-frame.loading {min-height: 250px; background-color: #f0f0f0; position: relative; display: flex; justify-content: center; align-items: center;}
.image-frame.loading img:not(.user-avatar) {opacity: 0; transition: opacity 0.4s ease;}
.image-frame img:not(.user-avatar) {width: 100%; height: auto; display: block; object-fit: cover; opacity: 1; transition: opacity 0.4s ease;}

.spinner {position: absolute; border: 4px solid #f3f3f3; border-top: 4px solid #e60023; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; z-index: 10;}
@keyframes spin {0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); }}

.user-avatar {position:absolute;bottom:10px;right:10px;width:32px;height:32px;border-radius:50%;border:3px solid #fff;box-shadow:0 2px 5px rgba(0,0,0,0.4);transition:transform 0.3s;z-index:5;object-fit:cover;}
.image-frame:hover .user-avatar {transform:scale(1.1);}
.pagination{display:flex;justify-content:center;gap:8px;margin:20px 0 40px 0;}
.pagination button{padding:8px 14px;border:none;border-radius:8px;background:#e60023;color:#fff;cursor:pointer;font-weight:600;transition:0.2s;}
.pagination button:hover{background:#ad081b;transform:scale(1.05);}
.pagination button.active{background:#ff3b5c;}

#imageModal{display:flex;position:fixed;inset:0;background:rgba(0,0,0,0.75);backdrop-filter:blur(12px);z-index:2000;justify-content:center;align-items:center;flex-direction:column;opacity:0;visibility:hidden;transition:opacity 0.4s ease,visibility 0.4s;}
#imageModal.visible{opacity:1;visibility:visible;}
#modalImg{max-width:90%;max-height:85%;border-radius:18px;box-shadow:0 8px 30px rgba(0,0,0,0.7);object-fit:contain;cursor:default;transform:scale(0.8);transition:transform 0.4s cubic-bezier(0.25,0.8,0.25,1);}
#imageModal.visible #modalImg{transform:scale(1);}
#closeBtn{margin-top:20px;padding:12px 25px;background:#e60023;color:#fff;border:none;border-radius:10px;font-weight:600;cursor:pointer;opacity:0;transition:transform 0.2s,opacity 0.3s,background-color 0.3s;}
#closeBtn:hover{transform:scale(1.05);background:#ad081b;}
#imageModal.visible #closeBtn{opacity:1;}

#welcomeScreen {position: fixed; inset: 0; z-index: 3000; display: flex; justify-content: center; align-items: center; flex-direction: column; background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(8px); opacity: 1; transition: opacity 0.8s ease;}
#welcomeText {font-size: 30px; font-weight: 900; color: #fff; opacity: 0; transform: translateY(-20px) scale(0.95); transition: opacity 1.2s ease, transform 1.2s ease; text-shadow: 0 0 15px rgba(255, 255, 255, 0.8), 0 0 30px rgba(230, 0, 35, 0.5); letter-spacing: 5px; }
#welcomeScreen.fading-out {opacity: 0; pointer-events: none; backdrop-filter: blur(0px); }
#welcomeScreen.fading-out #welcomeText {opacity: 0 !important; transform: translateY(20px) scale(1.05); }

#credit {position: fixed; bottom: 10px; right: 10px; font-size: 14px; color: #fff; z-index: 9999;}
</style>
</head>
<body class="lock-scroll">

<header>
<h1>Th∆∞ vi·ªán c√∫c cu üå∏</h1>
<div class="datetime">
<span id="currentDate"></span>
<span id="currentTime"></span>
</div>
</header>

<div id="mainBackgroundOverlay"></div> 

<div id="welcomeScreen">
    <span id="welcomeText">Th∆∞ vi·ªán c√∫c cu üîû</span>
</div>

<div id="socialLinks" style="opacity: 0; pointer-events: none; transition: opacity 0.5s;">
    <a href="#" onclick="openSocialImage('https://i.supaimg.com/ce5666cd-e93a-4e2c-86dc-a07fdb4a1eea.jpg')" id="tiktokLink">Tik tok</a>
    <a href="#" onclick="openSocialImage('https://i.supaimg.com/8968b9c8-8cb8-4721-98e7-80e961e9bce2.jpg')" id="facebookLink">Facebook</a>
</div>

<div id="dailyBanner" style="display:none"></div>
<div class="banner-label" id="fixedBannerLabel" style="display:none">ƒê·ªÄ XU·∫§T H√îM NAY</div>

<main>
<div class="gallery-container" id="imageGallery"></div>
<div class="pagination" id="pagination"></div>
</main>

<div id="imageModal">
<img id="modalImg" src="">
<button id="closeBtn">ƒê√≥ng</button>
</div>
<div id="credit">¬© 2025 VƒÉn T∆∞·ªüng</div>

<script>
const gallery=document.getElementById('imageGallery');
const imageModal=document.getElementById('imageModal');
const modalImg=document.getElementById('modalImg');
const closeBtn=document.getElementById('closeBtn');
const dailyBanner=document.getElementById('dailyBanner');
const fixedBannerLabel=document.getElementById('fixedBannerLabel');
const main=document.querySelector('main');
const bodyElement=document.body;
const socialLinks = document.getElementById('socialLinks'); 
const welcomeScreen = document.getElementById('welcomeScreen'); 
const welcomeText = document.getElementById('welcomeText'); 

const IMAGES_PER_BANNER=3; 
const IMAGES_PER_PAGE=10;
const AVATAR_LINK="https://i.supaimg.com/a2d58894-47d1-4f24-9c9a-2733948faabe.png";
let currentPage=1;
let allGalleryImages = []; 

// ƒê√£ s·ª≠a: S·ª≠ d·ª•ng Raw URL ƒë·ªÉ t·∫£i file pass.json t·ª´ GitHub
const JSON_LINK = "https://raw.githubusercontent.com/vtuong2104-hub/update50/main/pass.json"; 

// --- H√ÄM X√ÅO TR·ªòN M·∫¢NG (Fisher-Yates) ---
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}
// ------------------------------------------

function setBannerLabelPosition(){
    const labelHeight=30;
    const offsetFromBottom=11;
    const bannerBottomPosition=45+18+220+18;
    const finalTop=bannerBottomPosition-(labelHeight/2)-offsetFromBottom;
    fixedBannerLabel.style.top=`${finalTop}px`;
}

function showDailyBanner(bannerImages){
    dailyBanner.innerHTML='';
    bannerImages.slice(0,IMAGES_PER_BANNER).forEach(link=>{
        const img=document.createElement('img');
        img.src=link;
        img.onclick=e=>{e.stopPropagation();openImage(link)};
        dailyBanner.appendChild(img);
    });
    dailyBanner.style.display='flex';
    fixedBannerLabel.style.display='block';
    setBannerLabelPosition();
}

function initializeContent(data){
    // 1. G√°n Background t·ª´ data.background
    if (data.background) {
        bodyElement.style.backgroundImage = `url('${data.background}')`;
    }
    
    let allImages = data.images || []; 
    
    // B∆Ø·ªöC 1: X√°o tr·ªôn to√†n b·ªô m·∫£ng ·∫£nh
    allImages = shuffleArray(allImages); 
    
    // B∆Ø·ªöC 2: T√°ch m·∫£ng ƒë·ªÉ Banner kh√¥ng l·∫•y ·∫£nh t·ª´ Trang 1
    
    // Gallery s·ª≠ d·ª•ng to√†n b·ªô ·∫£nh ƒë√£ x√°o tr·ªôn
    const galleryImages = allImages;
    
    // Banner l·∫•y ·∫£nh t·ª´ nh·ªØng ·∫£nh sau Trang 1, sau ƒë√≥ t·ª± x√°o tr·ªôn l·∫°i
    let potentialBannerImages = allImages.slice(IMAGES_PER_PAGE); 
    potentialBannerImages = shuffleArray(potentialBannerImages); 
    
    // L·∫•y s·ªë l∆∞·ª£ng ·∫£nh Banner c·∫ßn thi·∫øt
    const bannerImages = potentialBannerImages.slice(0, IMAGES_PER_BANNER); 

    
    showDailyBanner(bannerImages);
    allGalleryImages = galleryImages; 
    displayPage(currentPage, allGalleryImages);
    
    // Khi d·ªØ li·ªáu ƒë∆∞·ª£c load, l√†m m·ªù overlay ƒë·ªÉ l·ªô background
    const overlay = document.getElementById('mainBackgroundOverlay');
    if (overlay) overlay.style.opacity = '0';
}

function displayPage(page,images){
    gallery.style.opacity='0'; 
    setTimeout(()=>{
        gallery.innerHTML='';
        const start=(page-1)*IMAGES_PER_PAGE;
        const end=start+IMAGES_PER_PAGE;
        images.slice(start,end).forEach((link,index)=>{
            const frame=document.createElement('div');
            frame.className='image-frame loading';
            const spinner = document.createElement('div'); spinner.className = 'spinner';
            const img=document.createElement('img'); img.alt='·∫¢nh '+(start+index+1);
            
            // X√≥a spinner v√† g·ª° tr·∫°ng th√°i loading khi ·∫£nh load xong
            img.onload = () => { 
                frame.classList.remove('loading'); 
                if(spinner.parentNode){
                    frame.removeChild(spinner);
                } 
            };
            
            // X·ª≠ l√Ω l·ªói load ·∫£nh (v√≠ d·ª•: ·∫£nh b·ªã x√≥a ho·∫∑c URL sai)
            img.onerror = () => {
                console.warn(`Kh√¥ng t·∫£i ƒë∆∞·ª£c ·∫£nh: ${link}`);
                frame.classList.remove('loading');
                if(spinner.parentNode){
                    frame.removeChild(spinner);
                }
                frame.style.backgroundColor = '#ffdddd'; // D·∫•u hi·ªáu ·∫£nh l·ªói
            };


            img.src=link;
            const avatar=document.createElement('img'); avatar.className='user-avatar'; avatar.src=AVATAR_LINK;
            frame.appendChild(spinner); frame.appendChild(img); frame.appendChild(avatar);
            frame.onclick=()=>{openImage(link);};
            gallery.appendChild(frame);
        });
        gallery.style.opacity='1'; // Hi·ªán gallery
        updateBannerVisibility(page);
        setupPagination(images,page);
        window.scrollTo({ top: 0, behavior: 'smooth' });
    },200);
}

function updateBannerVisibility(page){
    if(page===1){
        dailyBanner.style.opacity='1';
        dailyBanner.style.pointerEvents='auto';
        fixedBannerLabel.style.opacity='1';
        main.style.paddingTop='295px';
    }else{
        dailyBanner.style.opacity='0';
        dailyBanner.style.pointerEvents='none';
        fixedBannerLabel.style.opacity='0';
        main.style.paddingTop='40px';
    }
}

function setupPagination(images,current){
    const pagination=document.getElementById('pagination');pagination.innerHTML='';
    const totalPages=Math.ceil(images.length/IMAGES_PER_PAGE);
    for(let i=1;i<=totalPages;i++){
        const btn=document.createElement('button');btn.textContent=i;if(i===current)btn.classList.add('active');
        btn.onclick=()=>{if(i!==currentPage){currentPage=i;displayPage(currentPage, images);}}
        pagination.appendChild(btn);
    }
}

function openImage(link){ modalImg.src=link; imageModal.classList.add('visible'); document.body.classList.add('lock-scroll'); }
function closeImage(){ imageModal.classList.remove('visible'); document.body.classList.remove('lock-scroll'); setTimeout(()=>{modalImg.src='';},400); }
closeBtn.onclick=closeImage; imageModal.onclick=e=>{if(e.target.id==='imageModal'||e.target.id==='closeBtn'){closeImage();}};
document.addEventListener('keydown',e=>{if(e.key==="Escape"&&imageModal.classList.contains('visible')){closeImage();}});
function openSocialImage(link){ openImage(link); }

function showWelcomeScreen() {
    setTimeout(() => { welcomeText.style.opacity = '1'; welcomeText.style.transform = 'translateY(0px) scale(1)'; }, 100);
    setTimeout(() => {
        welcomeScreen.classList.add('fading-out');
        setTimeout(() => {
            bodyElement.classList.remove('lock-scroll');
            // --- L·ªÜNH FETCH S·ª¨ D·ª§NG JSON_LINK ƒê√É S·ª¨A ---
            fetch(JSON_LINK)
            .then(res => {
                if (!res.ok) throw new Error('L·ªói t·∫£i pass.json: ' + res.status);
                return res.json();
            })
            .then(data=>{ 
                initializeContent(data); 
            })
            .catch(err=>{ 
                console.error('Kh√¥ng load ƒë∆∞·ª£c pass.json', err); 
                alert('L·ªói: Kh√¥ng th·ªÉ t·∫£i th∆∞ vi·ªán ·∫£nh. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng ho·∫∑c ƒë∆∞·ªùng d·∫´n file pass.json.');
            });
            // --- K·∫øt th√∫c fetch JSON ---
            
            socialLinks.style.opacity = '1';
            socialLinks.style.pointerEvents = 'auto';
        }, 800);
    }, 2000);
}

function updateDateTime(){
    const now=new Date();
    document.getElementById('currentDate').textContent=now.toLocaleDateString('vi-VN',{day:'2-digit',month:'2-digit',year:'numeric'});
    document.getElementById('currentTime').textContent=now.toLocaleTimeString('vi-VN',{hour:'2-digit',minute:'2-digit'});
}
setInterval(updateDateTime,1000);
updateDateTime();
window.onload = function() { showWelcomeScreen(); };
</script>
</body>
</html>
